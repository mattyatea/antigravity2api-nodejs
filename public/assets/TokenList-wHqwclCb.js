import{d as ee,a as te,v as w,c as A,x as ae,i as le,b as c,p as d,n as U,e,t as n,f as s,w as T,y as X,z as O,l as B,F as D,A as ne,r as Y,B as J,C as oe,D as ce,q as R,_ as N,h as ue,j as ge}from"./index-CDUZ-j6a.js";import{a as I,u as ie}from"./useSettings-Dz22ztbU.js";const L={},me=300*1e3;function be(){function k(t){const i=L[t];return i?Date.now()-i.timestamp>me?(delete L[t],null):i.data:null}function b(t,i){L[t]={data:i,timestamp:Date.now()}}function x(t){if(t)delete L[t];else for(const i in L)delete L[i]}async function _(t,i=!1){if(i)x(t);else{const u=k(t);if(u)return u}try{const a=await(await I(`/admin/tokens/${encodeURIComponent(t)}/quotas${i?"?refresh=true":""}`)).json();if(a.success&&a.data)return b(t,a.data),a.data;throw new Error(a.message||"Unknown error")}catch(u){throw u}}return{fetchQuota:_,clearCache:x}}const he={class:"mb-3 flex items-center justify-between"},pe={class:"flex items-center gap-2"},ke={class:"text-xs text-gray-400 font-mono"},fe={class:"mb-4 flex flex-col gap-2"},xe={class:"flex items-center gap-2 text-xs font-mono"},ye={class:"truncate text-black dark:text-white"},ve={class:"truncate text-gray-700 dark:text-gray-300"},we={class:"truncate text-gray-700 dark:text-gray-300"},_e={class:"flex items-center gap-2 text-xs mt-1"},$e={key:0},Ce=["disabled"],je={class:"mb-4 overflow-hidden rounded-md border border-gray-200 bg-gray-50 dark:border-gray-800 dark:bg-gray-900/50"},Te={class:"flex min-w-0 flex-1 items-center gap-3 text-xs"},Ie={class:"flex-1 min-w-0 truncate font-medium text-gray-900 dark:text-gray-100"},Me={class:"flex items-center gap-2"},Se={class:"h-1.5 w-[60px] shrink-0 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700"},Ue={class:"min-w-[32px] shrink-0 font-mono text-right text-[10px]"},Ve={key:2,class:"text-[10px] text-gray-500"},De={key:0,class:"border-t border-gray-200 bg-white p-2 dark:border-gray-800 dark:bg-black"},Oe={key:0,class:"p-2 text-center text-[10px] text-gray-400"},Re={key:1,class:"p-2 text-center text-[10px] text-gray-500"},Ee={key:2,class:"flex flex-col gap-2"},Le={class:"w-12 shrink-0 truncate text-gray-500 uppercase font-mono"},Ne={class:"flex-1 min-w-0 truncate text-gray-700 dark:text-gray-300"},Be={class:"h-1 w-[40px] shrink-0 overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800"},Ae={class:"min-w-[28px] shrink-0 font-mono text-right text-gray-900 dark:text-gray-100"},Pe={class:"flex justify-end gap-2 mt-auto pt-2 border-t border-gray-100 dark:border-gray-800"},qe=ee({__name:"TokenCard",props:{token:{},index:{}},emits:["refresh-list","delete","view-quota","edit"],setup(k,{emit:b}){const x=k,_=b,{fetchQuota:t}=be(),{sensitiveInfoHidden:i}=ie(),{showToast:u}=oe(),{t:a}=te(),p=w(!1),g=w(null),$=w(null),V=w(!1),v=w(!1),S=w(null),P=A(()=>new Date(x.token.timestamp+x.token.expires_in*1e3)),C=A(()=>P.value<new Date),q=A(()=>P.value.toLocaleString(void 0,{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}));async function E(){try{const f=await t(x.token.refresh_token);if(f&&f.models){const l=f.models,m=Object.entries(l);if(m.length===0||!m[0]){g.value={text:"N/A"};return}let y=m[0][0],M=m[0][1];m.forEach(([j,h])=>{h.remaining<M.remaining&&(M=h,y=j)});const r=M.remaining*100,o=y.replace("models/","").replace("publishers/google/","").split("/").pop();g.value={shortName:o,percentage:r,barColor:r>50?"#10b981":r>20?"#f59e0b":"#ef4444",pctText:`${r.toFixed(2)}%`,fullName:y}}}catch{g.value={error:!0}}}async function F(){if(!p.value){p.value=!0;try{const l=await(await I(`/admin/tokens/${encodeURIComponent(x.token.refresh_token)}/refresh`,{method:"POST"})).json();l.success?(u(a("common.success"),"success"),_("refresh-list")):u(`${a("tokens.refresh_failed")}: ${l.message}`,"error")}catch(f){u(`${a("tokens.refresh_failed")}: ${f.message}`,"error")}finally{p.value=!1}}}async function H(){const f=x.token.enable?a("tokens.status_disable_action"):a("tokens.status_enable_action");if(confirm(a("tokens.toggle_confirm",{action:f})))try{(await(await I(`/admin/tokens/${encodeURIComponent(x.token.refresh_token)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enable:!x.token.enable})})).json()).success?(u(a("common.success"),"success"),_("refresh-list")):u(a("common.error"),"error")}catch(l){u(`${a("common.error")}: ${l.message}`,"error")}}async function Z(){_("delete",x.token.refresh_token)}async function W(){v.value=!v.value,v.value&&!$.value&&await Q()}async function Q(f=!1){V.value=!0,S.value=null;try{const l=await t(x.token.refresh_token,f);if(l&&l.models){const m={claude:[],gemini:[],other:[]};Object.entries(l.models).forEach(([y,M])=>{const r={modelId:y,quota:M},o=y.toLowerCase();o.includes("claude")?m.claude.push(r):o.includes("gemini")?m.gemini.push(r):m.other.push(r)}),$.value=m,E()}else S.value=a("tokens.empty")}catch(l){S.value=l.message||a("common.error")}finally{V.value=!1}}async function G(f,l){try{(await(await I(`/admin/tokens/${encodeURIComponent(x.token.refresh_token)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({[f]:l})})).json()).success?(u(a("common.saved"),"success"),_("refresh-list")):u(a("common.error"),"error")}catch{u(a("common.error"),"error")}}function z(f,l){const m=a(f==="projectId"?"tokens.id_label":"tokens.email_label"),y=prompt(`${a("common.edit")} ${m}`,l);y!==null&&y!==l&&G(f,y)}return ae(()=>{E()}),(f,l)=>{const m=le("tooltip");return d(),c("div",{class:U(["group relative flex flex-col rounded-lg border p-4 transition-all duration-200 bg-white dark:bg-black shadow-sm hover:border-black dark:hover:border-white hover:shadow-md",{"opacity-60":!k.token.enable,"border-gray-200 dark:border-gray-800":!p.value,"border-black dark:border-white ring-1 ring-black dark:ring-white":p.value}])},[e("div",he,[e("span",{class:U(["inline-flex items-center rounded-md px-2 py-1 text-xs font-bold border",k.token.enable?"bg-black text-white border-black dark:bg-white dark:text-black dark:border-white":"bg-gray-100 text-gray-500 border-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700"])},n(k.token.enable?s(a)("common.enabled"):s(a)("common.disabled")),3),e("div",pe,[T((d(),c("button",{class:"flex h-6 w-6 items-center justify-center rounded border border-gray-200 hover:border-black hover:bg-black hover:text-white transition-colors text-xs",onClick:l[0]||(l[0]=y=>f.$emit("edit",k.token))},[...l[4]||(l[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),e("path",{d:"m15 5 4 4"})],-1)])])),[[m,s(a)("common.edit")]]),e("span",ke,"#"+n(k.index+1),1)])]),e("div",fe,[T(e("div",xe,[l[5]||(l[5]=e("span",{class:"text-gray-400 w-4"},"ID",-1)),T((d(),c("span",ye,[O(n(k.token.access_token_suffix),1)])),[[m,k.token.access_token_suffix]])],512),[[X,!s(i)]]),T((d(),c("div",{class:"group/row flex cursor-pointer items-center gap-2 rounded px-1 -mx-1 py-0.5 transition-colors hover:bg-gray-50 dark:hover:bg-gray-900",onClick:l[1]||(l[1]=y=>z("projectId",k.token.projectId))},[l[6]||(l[6]=e("span",{class:"text-gray-400 w-4"},"PR",-1)),e("span",ve,n(k.token.projectId||s(a)("tokens.project_id_placeholder")),1)])),[[X,!s(i)],[m,s(a)("common.edit")]]),T((d(),c("div",{class:"group/row flex cursor-pointer items-center gap-2 rounded px-1 -mx-1 py-0.5 transition-colors hover:bg-gray-50 dark:hover:bg-gray-900",onClick:l[2]||(l[2]=y=>z("email",k.token.email))},[l[7]||(l[7]=e("span",{class:"text-gray-400 w-4"},"@",-1)),e("span",we,n(k.token.email||s(a)("tokens.email_placeholder")),1)])),[[X,!s(i)],[m,s(a)("common.edit")]]),e("div",_e,[l[9]||(l[9]=e("span",{class:"text-gray-400 w-4"},"Ex",-1)),e("span",{class:U({"text-black font-bold dark:text-white":C.value,"text-gray-600 dark:text-gray-400":!C.value})},[O(n(p.value?s(a)("tokens.refreshing"):q.value)+" ",1),C.value&&!p.value?(d(),c("span",$e," ("+n(s(a)("tokens.expired"))+")",1)):B("",!0)],2),T((d(),c("button",{class:"ml-auto p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-900 transition-colors",onClick:F,disabled:p.value},[(d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:U({"animate-spin":p.value})},[...l[8]||(l[8]=[e("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"},null,-1),e("path",{d:"M21 3v5h-5"},null,-1),e("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"},null,-1),e("path",{d:"M8 16H3v5"},null,-1)])],2))],8,Ce)),[[m,s(a)("tokens.refresh_btn")]])])]),e("div",je,[e("div",{class:"flex cursor-pointer items-center justify-between p-2 px-3 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800",onClick:W},[e("span",Te,[g.value&&!g.value.error&&!g.value.text?(d(),c(D,{key:0},[T((d(),c("span",Ie,[O(n(g.value.shortName),1)])),[[m,g.value.fullName]]),e("div",Me,[e("span",Se,[e("span",{class:"block h-full rounded-full bg-black dark:bg-white",style:ne({width:g.value.percentage+"%"})},null,4)]),e("span",Ue,n(g.value.pctText),1)])],64)):g.value&&g.value.text?(d(),c(D,{key:1},[O(n(g.value.text),1)],64)):g.value&&g.value.error?(d(),c("span",Ve,n(s(a)("common.error")),1)):(d(),c(D,{key:3},[O(n(s(a)("common.loading")),1)],64))]),(d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:U(["ml-2 text-gray-400 transition-transform duration-200",{"rotate-180":v.value}])},[...l[10]||(l[10]=[e("path",{d:"m6 9 6 6 6-6"},null,-1)])],2))]),v.value?(d(),c("div",De,[V.value?(d(),c("div",Oe,n(s(a)("common.loading")),1)):S.value?(d(),c("div",Re,n(S.value),1)):(d(),c("div",Ee,[(d(!0),c(D,null,Y($.value,(y,M)=>(d(),c(D,{key:M},[(d(!0),c(D,null,Y(y,r=>T((d(),c("div",{key:r.modelId,class:"flex items-center gap-2 text-[10px]"},[e("span",Le,n(M),1),e("span",Ne,n(r.modelId.split("/").pop()),1),e("span",Be,[e("span",{class:"block h-full rounded-full bg-black dark:bg-white",style:ne({width:r.quota.remaining*100+"%"})},null,4)]),e("span",Ae,n((r.quota.remaining*100).toFixed(0))+"%",1)])),[[m,r.modelId]])),128))],64))),128)),e("button",{class:"mt-2 w-full rounded border border-gray-200 py-1 text-center text-[10px] font-medium text-gray-600 hover:bg-gray-50 hover:text-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white transition-colors",onClick:l[3]||(l[3]=J(y=>Q(!0),["stop"]))},n(s(a)("tokens.quota_refresh")),1)]))])):B("",!0)]),e("div",Pe,[e("button",{class:U(["px-3 py-1.5 text-xs rounded font-medium transition-colors flex items-center justify-center gap-1.5",k.token.enable?"bg-white border border-gray-200 text-black hover:bg-gray-50 dark:bg-black dark:border-gray-700 dark:text-white dark:hover:bg-gray-900":"bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200"]),onClick:H},n(k.token.enable?s(a)("common.disabled"):s(a)("common.enabled")),3),T((d(),c("button",{class:"px-3 py-1.5 text-xs rounded font-medium transition-colors flex items-center justify-center gap-1.5 text-gray-500 hover:text-red-500 hover:bg-transparent",onClick:Z},[...l[11]||(l[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M3 6h18"}),e("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})],-1)])])),[[m,s(a)("common.delete")]])])],2)}}}),Fe={class:"w-full max-w-[400px] rounded-lg border border-gray-200 bg-white p-6 shadow-xl dark:border-gray-800 dark:bg-black"},Qe={class:"mb-4 text-base font-bold text-black dark:text-white"},ze={class:"mb-4"},Je={class:"block mb-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wide"},He={class:"rounded-md border border-gray-200 bg-gray-50 p-2 font-mono text-xs text-gray-600 break-all overflow-y-auto max-h-[80px] select-all cursor-text dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400"},Ze={class:"mb-4"},We={class:"block mb-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wide"},Ge={class:"rounded-md border border-gray-200 bg-gray-50 p-2 font-mono text-xs text-gray-600 break-all overflow-y-auto max-h-[80px] select-all cursor-text dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400"},Ke={class:"mb-4"},Xe={class:"mb-4"},Ye={class:"mb-4"},et={class:"block mb-1 text-xs font-semibold text-gray-500 uppercase tracking-wide"},tt=["value"],ot={class:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-100 dark:border-gray-800"},st=ee({__name:"TokenDetailModal",props:{token:{},show:{type:Boolean}},emits:["close","saved"],setup(k,{emit:b}){const x=k,_=b,{showToast:t}=oe(),{t:i}=te(),u=w({projectId:"",email:""});ce(()=>x.token,p=>{p&&(u.value.projectId=p.projectId||"",u.value.email=p.email||"")},{immediate:!0});async function a(){try{const g=await(await I(`/admin/tokens/${encodeURIComponent(x.token.refresh_token)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)})).json();g.success?(t(i("common.saved"),"success"),_("saved"),_("close")):t(`${i("common.error")}: ${g.message}`,"error")}catch(p){t(`${i("common.error")}: ${p.message}`,"error")}}return(p,g)=>k.show?(d(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm",onClick:g[3]||(g[3]=J($=>p.$emit("close"),["self"]))},[e("div",Fe,[e("div",Qe,n(s(i)("common.edit")),1),e("div",ze,[e("label",Je,n(s(i)("tokens.access_token")),1),e("div",He,n(k.token.access_token||""),1)]),e("div",Ze,[e("label",We,n(s(i)("tokens.refresh_token")),1),e("div",Ge,n(k.token.refresh_token),1)]),e("div",Ke,[R(N,{modelValue:u.value.projectId,"onUpdate:modelValue":g[0]||(g[0]=$=>u.value.projectId=$),label:s(i)("tokens.id_label"),placeholder:s(i)("tokens.project_id_placeholder")},null,8,["modelValue","label","placeholder"])]),e("div",Xe,[R(N,{modelValue:u.value.email,"onUpdate:modelValue":g[1]||(g[1]=$=>u.value.email=$),label:s(i)("tokens.email_label"),type:"email",placeholder:s(i)("tokens.email_placeholder")},null,8,["modelValue","label","placeholder"])]),e("div",Ye,[e("label",et,n(s(i)("tokens.expire_time")),1),e("input",{class:"w-full min-h-[36px] px-3 py-2 text-xs border border-gray-200 rounded-md bg-gray-50 text-gray-700 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 opacity-80 cursor-not-allowed focus:outline-none font-mono",type:"text",value:new Date(k.token.timestamp+k.token.expires_in*1e3).toLocaleString(),readonly:""},null,8,tt)]),e("div",ot,[e("button",{class:"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed text-gray-600 hover:bg-gray-100 hover:text-black dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white",onClick:g[2]||(g[2]=$=>p.$emit("close"))},n(s(i)("common.cancel")),1),e("button",{class:"inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200",onClick:a},n(s(i)("common.save")),1)])])])):B("",!0)}}),rt={class:"flex flex-1 flex-col min-h-0 overflow-hidden"},nt={class:"mb-6 rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:bg-black dark:border-gray-800"},at={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},lt={class:"flex gap-1 p-1 bg-gray-100 dark:bg-gray-900 rounded-lg"},it={class:"font-bold"},dt={class:"text-xs uppercase tracking-wider opacity-70"},ct={class:"font-bold"},ut={class:"text-xs uppercase tracking-wider opacity-70"},gt={class:"font-bold"},mt={class:"text-xs uppercase tracking-wider opacity-70"},bt={class:"flex flex-wrap gap-2"},ht={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},pt={key:1,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},kt={class:"grid grid-cols-1 gap-4 overflow-y-auto p-1 pt-0 sm:grid-cols-2 lg:grid-cols-[repeat(auto-fill,minmax(300px,1fr))]",id:"tokenList"},ft={key:0,class:"col-span-full flex min-h-[300px] flex-col items-center justify-center py-12 text-center text-gray-400"},xt={class:"mb-2 text-lg font-medium text-black dark:text-white"},yt={class:"text-sm"},vt={class:"w-full max-w-[480px] rounded-lg border border-gray-200 bg-white p-6 shadow-xl dark:border-gray-800 dark:bg-black"},wt={class:"mb-4 text-lg font-bold text-black dark:text-white"},_t={class:"mb-6 rounded bg-gray-50 p-4 text-sm text-gray-600 dark:bg-gray-900 dark:text-gray-300"},$t={class:"mb-2"},Ct={class:"mb-2"},jt={class:"mb-2"},Tt={class:"mb-0"},It={class:"mb-4 flex gap-3"},Mt={class:"mb-6"},St={class:"flex justify-end gap-3"},Ut={class:"w-full max-w-[480px] rounded-lg border border-gray-200 bg-white p-6 shadow-xl dark:border-gray-800 dark:bg-black"},Vt={class:"mb-4 text-lg font-bold text-black dark:text-white"},Dt={class:"mb-6 flex flex-col gap-4"},Ot={class:"mb-6 text-xs text-gray-500"},Rt={class:"flex justify-end gap-3"},Et="1071006060591-tmhssin2h21lcre235vtolojh4g403ep.apps.googleusercontent.com",At=ee({__name:"TokenList",setup(k){const{showToast:b}=oe(),{toggleSensitiveInfo:x,sensitiveInfoHidden:_}=ie(),{t}=te(),i=w([]),u=w("all"),a=w(!1),p=w(!1),g=w(!1),$=w(null),V=w(""),v=w({accessToken:"",refreshToken:"",expiresIn:3599});let S=null;const P=["https://www.googleapis.com/auth/cloud-platform","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/cclog","https://www.googleapis.com/auth/experimentsandconfigs"].join(" ");async function C(){try{const o=await(await I("/admin/tokens")).json();o.success?(i.value=o.data,y()):b(`${t("common.error")}: ${o.message}`,"error")}catch(r){b(`${t("common.error")}: ${r.message}`,"error")}}const q=A(()=>u.value==="enabled"?i.value.filter(r=>r.enable):u.value==="disabled"?i.value.filter(r=>!r.enable):i.value),E=A(()=>({total:i.value.length,enabled:i.value.filter(r=>r.enable).length,disabled:i.value.filter(r=>!r.enable).length}));function F(){S||(S=Math.floor(Math.random()*1e4)+5e4);const r=`http://localhost:${S}/oauth-callback`;return`https://accounts.google.com/o/oauth2/v2/auth?access_type=offline&client_id=${Et}&prompt=consent&redirect_uri=${encodeURIComponent(r)}&response_type=code&scope=${encodeURIComponent(P)}&state=${Date.now()}`}function H(){window.open(F(),"_blank")}function Z(){const r=F();navigator.clipboard.writeText(r).then(()=>{b(t("oauth.link_copied"),"success")}).catch(()=>{b(t("common.error"),"error")})}function W(){b(t("common.info"),"info"),a.value=!0}async function Q(){const r=V.value.trim();if(!r){b(t("common.warning"),"warning");return}b(t("common.loading"),"info");try{const o=new URL(r),j=o.searchParams.get("code"),h=new URL(o.origin).port||(o.protocol==="https:"?443:80);if(!j){b(t("common.error"),"error");return}const K=await(await I("/admin/oauth/exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:j,port:h})})).json();if(K.success){const de=K.data,re=await(await I("/admin/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(de)})).json();re.success?(a.value=!1,V.value="",b(t("common.success"),"success"),C()):b(`${t("common.error")}: ${re.message}`,"error")}else b(`${t("common.error")}: ${K.message}`,"error")}catch(o){b(`${t("common.error")}: ${o.message}`,"error")}}async function G(){if(!v.value.accessToken||!v.value.refreshToken){b(t("common.warning"),"warning");return}try{const o=await(await I("/admin/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:v.value.accessToken,refresh_token:v.value.refreshToken,expires_in:Number(v.value.expiresIn)})})).json();o.success?(p.value=!1,v.value={accessToken:"",refreshToken:"",expiresIn:3599},b(t("common.success"),"success"),C()):b(`${t("common.error")}: ${o.message}`,"error")}catch(r){b(`${t("common.error")}: ${r.message}`,"error")}}async function z(r){if(confirm(t("tokens.delete_confirm")))try{const j=await(await I(`/admin/tokens/${encodeURIComponent(r)}`,{method:"DELETE"})).json();j.success?(b(t("common.success"),"success"),C()):b(`${t("common.error")}: ${j.message}`,"error")}catch(o){b(`${t("common.error")}: ${o.message}`,"error")}}function f(r){$.value=r,g.value=!0}function l(r){b(t("tokens.quota_detail"),"info")}const m=new Set;function y(){i.value.forEach(r=>{new Date(r.timestamp+r.expires_in*1e3)<new Date&&r.enable&&!m.has(r.refresh_token)&&M(r.refresh_token)})}async function M(r){m.add(r);try{(await(await I(`/admin/tokens/${encodeURIComponent(r)}/refresh`,{method:"POST"})).json()).success&&(b(t("common.success"),"success"),C())}catch{}m.delete(r)}return ae(()=>{C()}),(r,o)=>{const j=le("tooltip");return d(),c("div",rt,[e("div",nt,[e("div",at,[e("div",lt,[e("button",{class:U(["flex flex-1 items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-all",u.value==="all"?"bg-white text-black shadow-sm dark:bg-gray-800 dark:text-white":"text-gray-500 hover:text-black hover:bg-white/50 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-800/50"]),onClick:o[0]||(o[0]=h=>u.value="all")},[e("span",it,n(E.value.total),1),e("span",dt,n(s(t)("tokens.total")),1)],2),e("button",{class:U(["flex flex-1 items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-all",u.value==="enabled"?"bg-white text-black shadow-sm dark:bg-gray-800 dark:text-white":"text-gray-500 hover:text-black hover:bg-white/50 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-800/50"]),onClick:o[1]||(o[1]=h=>u.value="enabled")},[e("span",ct,n(E.value.enabled),1),e("span",ut,n(s(t)("tokens.enabled_count")),1)],2),e("button",{class:U(["flex flex-1 items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-all",u.value==="disabled"?"bg-white text-black shadow-sm dark:bg-gray-800 dark:text-white":"text-gray-500 hover:text-black hover:bg-white/50 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-800/50"]),onClick:o[2]||(o[2]=h=>u.value="disabled")},[e("span",gt,n(E.value.disabled),1),e("span",mt,n(s(t)("tokens.disabled_count")),1)],2)]),e("div",bt,[e("button",{type:"button",onClick:W,class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200"},[o[14]||(o[14]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)),O(" "+n(s(t)("tokens.oauth_btn")),1)]),e("button",{type:"button",onClick:o[3]||(o[3]=h=>p.value=!0),class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-black dark:text-gray-300 dark:hover:bg-gray-900"},[o[15]||(o[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 5v14"}),e("path",{d:"M5 12h14"})],-1)),O(" "+n(s(t)("tokens.manual_btn")),1)]),T((d(),c("button",{type:"button",onClick:C,class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed text-gray-600 hover:bg-gray-100 hover:text-black dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white"},[...o[16]||(o[16]=[ue('<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path><path d="M16 21h5v-5"></path></svg>',1)])])),[[j,s(t)("tokens.refresh_btn")]]),T((d(),c("button",{type:"button",onClick:o[4]||(o[4]=(...h)=>s(x)&&s(x)(...h)),class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed text-gray-600 hover:bg-gray-100 hover:text-black dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white"},[s(_)?(d(),c("svg",ht,[...o[17]||(o[17]=[e("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"},null,-1),e("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"},null,-1),e("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"},null,-1),e("line",{x1:"2",x2:"22",y1:"2",y2:"22"},null,-1)])])):(d(),c("svg",pt,[...o[18]||(o[18]=[e("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)])]))])),[[j,s(_)?s(t)("tokens.show_sensitive"):s(t)("tokens.hide_sensitive")]])])])]),e("div",kt,[q.value.length===0?(d(),c("div",ft,[o[19]||(o[19]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round",class:"mb-4 opacity-50"},[e("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e("line",{x1:"12",x2:"12",y1:"9",y2:"13"}),e("line",{x1:"12",x2:"12.01",y1:"17",y2:"17"})],-1)),e("div",xt,n(s(t)("tokens.empty")),1),e("div",yt,n(s(t)("tokens.empty_hint")),1)])):B("",!0),(d(!0),c(D,null,Y(q.value,(h,se)=>(d(),ge(qe,{key:h.refresh_token,token:h,index:se,onRefreshList:C,onDelete:z,onEdit:f,onViewQuota:l},null,8,["token","index"]))),128))]),a.value?(d(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm",onClick:o[7]||(o[7]=J(h=>a.value=!1,["self"]))},[e("div",vt,[e("div",wt,n(s(t)("oauth.title")),1),e("div",_t,[e("p",$t,[e("strong",null,n(s(t)("oauth.title")),1)]),e("p",Ct,"1. "+n(s(t)("oauth.step1")),1),e("p",jt,"2. "+n(s(t)("oauth.step2")),1),e("p",Tt,"3. "+n(s(t)("oauth.step3")),1)]),e("div",It,[e("button",{type:"button",onClick:H,class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200 flex-1 justify-center"},n(s(t)("oauth.open_page")),1),e("button",{type:"button",onClick:Z,class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:bg-black dark:text-gray-300 dark:hover:bg-gray-900 flex-1 justify-center"},n(s(t)("oauth.copy_link")),1)]),e("div",Mt,[R(N,{modelValue:V.value,"onUpdate:modelValue":o[5]||(o[5]=h=>V.value=h),placeholder:s(t)("oauth.callback_placeholder")},null,8,["modelValue","placeholder"])]),e("div",St,[e("button",{class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed text-gray-600 hover:bg-gray-100 hover:text-black dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white",onClick:o[6]||(o[6]=h=>a.value=!1)},n(s(t)("common.cancel")),1),e("button",{class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200",onClick:Q},n(s(t)("oauth.submit")),1)])])])):B("",!0),p.value?(d(),c("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm",onClick:o[12]||(o[12]=J(h=>p.value=!1,["self"]))},[e("div",Ut,[e("div",Vt,n(s(t)("manual.title")),1),e("div",Dt,[R(N,{modelValue:v.value.accessToken,"onUpdate:modelValue":o[8]||(o[8]=h=>v.value.accessToken=h),placeholder:"Access Token"},null,8,["modelValue"]),R(N,{modelValue:v.value.refreshToken,"onUpdate:modelValue":o[9]||(o[9]=h=>v.value.refreshToken=h),placeholder:"Refresh Token"},null,8,["modelValue"]),R(N,{modelValue:v.value.expiresIn,"onUpdate:modelValue":o[10]||(o[10]=h=>v.value.expiresIn=h),modelModifiers:{number:!0},placeholder:"Expires In (s)",type:"number"},null,8,["modelValue"])]),e("p",Ot,n(s(t)("manual.expire_hint")),1),e("div",Rt,[e("button",{class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed text-gray-600 hover:bg-gray-100 hover:text-black dark:text-gray-400 dark:hover:bg-gray-900 dark:hover:text-white",onClick:o[11]||(o[11]=h=>p.value=!1)},n(s(t)("common.cancel")),1),e("button",{class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 disabled:bg-opacity-50 disabled:cursor-not-allowed bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200",onClick:G},n(s(t)("manual.add")),1)])])])):B("",!0),R(st,{show:g.value,token:$.value,onClose:o[13]||(o[13]=h=>g.value=!1),onSaved:C},null,8,["show","token"])])}}});export{At as default};
